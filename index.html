<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campus Dating</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; }
  header { background:#075E54; color:white; padding:10px; text-align:center; font-size:18px; font-weight:bold; }
  .hidden { display:none; }
  .container { padding:10px; max-width:400px; margin:20px auto; background:white; border-radius:5px; box-shadow:0 0 5px rgba(0,0,0,0.1); }
  input { width:100%; padding:8px; margin:5px 0; font-size:14px; }
  button { width:100%; padding:10px; margin:5px 0; background:#075E54; color:white; border:none; cursor:pointer; }
  footer { background:#eee; text-align:center; padding:5px; font-size:12px; border-top:1px solid #ccc; position:fixed; bottom:0; width:100%; }
  nav { display:flex; justify-content:space-around; background:#fff; border-top:1px solid #ccc; position:fixed; bottom:30px; width:100%; }
  nav button { flex:1; padding:10px; border:none; background:none; font-size:14px; cursor:pointer; }
  nav button.active { color:#075E54; font-weight:bold; }
  .tab { display:none; padding:10px; }
  .tab.active { display:block; }
  #chatBox { border:1px solid #ccc; padding:10px; height:200px; overflow-y:auto; background:#fff; }
  #messageInput { width:70%; padding:5px; }
  #sendBtn { padding:6px 10px; background:#075E54; color:white; border:none; cursor:pointer; }
  .statusItem { border-bottom:1px solid #eee; padding:8px; cursor:pointer; }
  .statusItem:hover { background:#f0f0f0; }
  .settingsForm { display:flex; flex-direction:column; gap:10px; }
  .settingsForm input, .settingsForm select { padding:8px; font-size:14px; }
  .settingsForm button { padding:10px; background:#075E54; color:white; border:none; cursor:pointer; }
</style>
</head>
<body>

<header>Campus Dating</header>

<!-- LOGIN / REGISTER / FORGOT -->
<div id="authContainer" class="container">
  <div id="loginForm">
    <h3>Login</h3>
    <input type="text" id="loginUsername" placeholder="Username">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>
    <p><a href="#" onclick="showRegister()">Register</a> | <a href="#" onclick="showForgot()">Forgot Password?</a></p>
  </div>
  <div id="registerForm" class="hidden">
    <h3>Register</h3>
    <input type="text" id="regUsername" placeholder="Username">
    <input type="password" id="regPassword" placeholder="Password">
    <input type="file" id="regAvatar" accept="image/*">
    <button onclick="register()">Register</button>
    <p><a href="#" onclick="showLogin()">Back to Login</a></p>
  </div>
  <div id="forgotForm" class="hidden">
    <h3>Forgot Password</h3>
    <input type="text" id="forgotUsername" placeholder="Username">
    <button onclick="forgotPassword()">Reset Password</button>
    <p><a href="#" onclick="showLogin()">Back to Login</a></p>
  </div>
</div>

<!-- MAIN APP -->
<div id="appContainer" class="hidden">
  <div id="content">
    <div id="chatsTab" class="tab active">
      <h3>Chats</h3>
      <div id="chatBox"></div>
      <input type="text" id="messageInput" placeholder="Type a message..." />
      <button id="sendBtn">Send</button>
    </div>

    <div id="statusTab" class="tab">
      <h3>Status</h3>
      <input type="file" id="statusFile" accept="image/*,video/*" />
      <input type="text" id="statusText" placeholder="Add a text status..." />
      <button onclick="uploadStatus()">Upload Status</button>
      <div id="statusFeed"></div>
    </div>

    <div id="groupsTab" class="tab">
      <h3>Groups</h3>
      <input type="text" id="groupName" placeholder="Group Name" />
      <input type="text" id="groupMembers" placeholder="Add members (comma-separated)" />
      <button onclick="createGroup()">Create Group</button>
      <div id="groupList"></div>
    </div>

    <div id="settingsTab" class="tab">
      <h3>Settings</h3>
      <form class="settingsForm" onsubmit="updateProfile(event)">
        <input type="text" id="username" placeholder="Change Username" />
        <input type="file" id="profilePic" accept="image/*" />
        <input type="password" id="password" placeholder="New Password" />
        <select id="privacy">
          <option value="everyone">Everyone</option>
          <option value="contacts">My Contacts</option>
          <option value="nobody">Nobody</option>
        </select>
        <button type="submit">Save</button>
      </form>
    </div>
  </div>

  <nav>
    <button onclick="showTab('chatsTab')" class="active">Chats</button>
    <button onclick="showTab('statusTab')">Status</button>
    <button onclick="showTab('groupsTab')">Groups</button>
    <button onclick="showTab('settingsTab')">Settings</button>
  </nav>
</div>

<footer>App by: PAUL MAKOKHA</footer>

<script>
const API = "https://campus-dating-backend-10.onrender.com";
let currentUser = null;

// Show/hide forms
function showLogin() { document.getElementById('loginForm').classList.remove('hidden'); document.getElementById('registerForm').classList.add('hidden'); document.getElementById('forgotForm').classList.add('hidden'); }
function showRegister() { document.getElementById('loginForm').classList.add('hidden'); document.getElementById('registerForm').classList.remove('hidden'); document.getElementById('forgotForm').classList.add('hidden'); }
function showForgot() { document.getElementById('loginForm').classList.add('hidden'); document.getElementById('registerForm').classList.add('hidden'); document.getElementById('forgotForm').classList.remove('hidden'); }
function showTab(tabId) { document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); document.getElementById(tabId).classList.add('active'); document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); }

// === Auth functions ===
async function login() {
  const username = document.getElementById('loginUsername').value;
  const password = document.getElementById('loginPassword').value;
  const res = await fetch(`${API}/auth/login`, { method:'POST', headers:{ 'Content-Type':'application/json' }, body:JSON.stringify({ username,password })});
  if(res.ok) { const data=await res.json(); currentUser = username; localStorage.setItem('token', data.token); document.getElementById('authContainer').classList.add('hidden'); document.getElementById('appContainer').classList.remove('hidden'); loadStatus(); loadGroups(); } else alert('Login failed'); 
}

async function register() {
  const username = document.getElementById('regUsername').value;
  const password = document.getElementById('regPassword').value;
  const avatar = document.getElementById('regAvatar').files[0];
  const formData = new FormData();
  formData.append('username', username); formData.append('password', password);
  if(avatar) formData.append('avatar', avatar);
  const res = await fetch(`${API}/auth/register`, { method:'POST', body:formData });
  if(res.ok) { alert('Registered successfully'); showLogin(); } else alert('Registration failed');
}

async function forgotPassword() {
  const username = document.getElementById('forgotUsername').value;
  alert('Forgot password functionality will connect to backend API');
}

// === Chats ===
document.getElementById("sendBtn").onclick = async () => {
  const input = document.getElementById("messageInput");
  if(!input.value) return;
  const msg = { sender: currentUser, receiver: "demoUser2", text: input.value, isGroup:false };
  await fetch(`${API}/api/messages`, { method:'POST', headers:{ 'Content-Type':'application/json','Authorization':'Bearer '+localStorage.getItem('token') }, body:JSON.stringify(msg) });
  const div = document.createElement("div"); div.textContent = input.value; document.getElementById("chatBox").appendChild(div); input.value="";
};

// === Status ===
async function uploadStatus() {
  const fileInput = document.getElementById('statusFile'); const textInput = document.getElementById('statusText');
  const formData = new FormData(); if(fileInput.files[0]) formData.append('file', fileInput.files[0]); if(textInput.value) formData.append('text', textInput.value);
  const res = await fetch(`${API}/status`, { method:'POST', headers:{ 'Authorization':'Bearer '+localStorage.getItem('token') }, body:formData });
  if(res.ok) { alert('Status uploaded'); loadStatus(); }
}
async function loadStatus() {
  const res = await fetch(`${API}/status/feed`, { headers:{ 'Authorization':'Bearer '+localStorage.getItem('token') } });
  const data = await res.json(); const feed = document.getElementById('statusFeed'); feed.innerHTML='';
  data.forEach(st=>{ const div=document.createElement('div'); div.className='statusItem'; div.textContent=`${st.user}: ${st.text||''}`; if(st.fileUrl){ const img=document.createElement('img'); img.src=st.fileUrl; img.style.maxWidth='100px'; img.style.display='block'; div.appendChild(img); } feed.appendChild(div); });
}

// === Groups ===
async function createGroup() {
  const name = document.getElementById('groupName').value;
  const members = document.getElementById('groupMembers').value.split(',').map(s=>s.trim());
  const res = await fetch(`${API}/api/groups/create`, { method:'POST', headers:{ 'Content-Type':'application/json','Authorization':'Bearer '+localStorage.getItem('token') }, body:JSON.stringify({ name,members }) });
  if(res.ok) { alert('Group created'); loadGroups(); }
}
async function loadGroups() {
  const res = await fetch(`${API}/api/groups/${currentUser}`, { headers:{ 'Authorization':'Bearer '+localStorage.getItem('token') } });
  const data = await res.json(); const list=document.getElementById('groupList'); list.innerHTML='';
  data.forEach(g=>{ const div=document.createElement('div'); div.textContent=g.name; list.appendChild(div); });
}

// === Settings ===
async function updateProfile(e) {
  e.preventDefault();
  const formData = new FormData();
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const privacy = document.getElementById('privacy').value;
  const pic = document.getElementById('profilePic').files[0];
  if(username) formData.append('username', username); if(password) formData.append('password', password); if(pic) formData.append('avatar', pic); formData.append('privacy', privacy);
  const res = await fetch(`${API}/user/${currentUser}/profile`, { method:'PUT', headers:{ 'Authorization':'Bearer '+localStorage.getItem('token') }, body:formData });
  if(res.ok) alert('Profile updated');
}
</script>

</body>
</html>
