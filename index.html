<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campus Dating</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#FFE4EC; }
header { background:#FF4081; color:white; padding:10px; text-align:center; font-size:18px; font-weight:bold; position:fixed; width:100%; top:0; z-index:100; }
.hidden { display:none; }
.container { padding:20px; max-width:400px; margin:80px auto 20px; background:white; border-radius:5px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
input, select { width:100%; padding:10px; margin:8px 0; font-size:14px; box-sizing:border-box; }
button { width:100%; padding:10px; margin:8px 0; background:#FF4081; color:white; border:none; cursor:pointer; font-size:14px; border-radius:4px; }
footer { background:#FFE4EC; text-align:center; padding:5px; font-size:12px; border-top:1px solid #C2185B; position:fixed; bottom:0; width:100%; }
nav { display:flex; justify-content:space-around; background:#fff; border-top:1px solid #C2185B; position:fixed; bottom:30px; width:100%; }
nav button { flex:1; padding:10px; border:none; background:none; font-size:14px; cursor:pointer; color:#FF4081; }
nav button.active { color:#C2185B; font-weight:bold; }
.tab { display:none; padding:10px; margin-top:10px; }
.tab.active { display:block; }
#chatBox { border:1px solid #C2185B; padding:10px; height:300px; overflow-y:auto; background:#FFFFFF; border-radius:5px; }
#messageInput { width:70%; padding:5px; border:1px solid #C2185B; border-radius:4px; }
#sendBtn { padding:6px 10px; background:#FF4081; color:white; border:none; cursor:pointer; border-radius:4px; }
.statusItem { border-bottom:1px solid #F8BBD0; padding:8px; cursor:pointer; }
.statusItem:hover { background:#FFD1E5; }
.settingsForm { display:flex; flex-direction:column; gap:10px; }
.settingsForm input, .settingsForm select { padding:8px; font-size:14px; border:1px solid #FF4081; border-radius:4px; }
.settingsForm button { padding:10px; background:#FF4081; color:white; border:none; cursor:pointer; border-radius:4px; }
.contactItem { cursor:pointer; padding:5px; border-bottom:1px solid #F8BBD0; }
.contactItem:hover { background:#FFD1E5; }
@media screen and (max-width:480px){
  .container { margin:100px 10px 20px; width:auto; }
  #chatBox { height:200px; }
}
</style>
</head>
<body>

<header>Campus Dating</header>

<!-- AUTH -->
<div id="authContainer" class="container">
  <div id="loginForm">
    <h3>Login</h3>
    <input type="text" id="loginPhone" placeholder="+254712345678">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>
    <p style="text-align:center"><a href="#" onclick="showRegister()">Register</a> | <a href="#" onclick="showForgot()">Forgot Password?</a></p>
  </div>

  <div id="registerForm" class="hidden">
    <h3>Register</h3>
    <label for="countryCode">Country Code</label>
    <select id="countryCode">
      <option value="+254">ðŸ‡°ðŸ‡ª Kenya (+254)</option>
      <option value="+256">ðŸ‡ºðŸ‡¬ Uganda (+256)</option>
      <option value="+255">ðŸ‡¹ðŸ‡¿ Tanzania (+255)</option>
      <option value="+1">ðŸ‡ºðŸ‡¸ USA (+1)</option>
      <option value="+44">ðŸ‡¬ðŸ‡§ UK (+44)</option>
    </select>
    <input type="text" id="regPhone" placeholder="Phone number (without code)" />
    <input type="password" id="regPassword" placeholder="Password">
    <input type="file" id="regAvatar" accept="image/*">
    <button onclick="register()">Register</button>
    <p style="text-align:center"><a href="#" onclick="showLogin()">Back to Login</a></p>
  </div>

  <div id="forgotForm" class="hidden">
    <h3>Forgot Password</h3>
    <input type="text" id="forgotPhone" placeholder="Enter your phone number">
    <button onclick="forgotPassword()">Reset Password</button>
    <p style="text-align:center"><a href="#" onclick="showLogin()">Back to Login</a></p>
  </div>
</div>

<!-- MAIN APP -->
<div id="appContainer" class="hidden container">
  <div id="content">
    <!-- Chats -->
    <div id="chatsTab" class="tab active">
      <h3>Chats</h3>
      <select id="chatReceiver"><option value="">Select Contact</option></select>
      <div id="chatBox"></div>
      <input type="text" id="messageInput" placeholder="Type a message..." />
      <button id="sendBtn">Send</button>
    </div>

    <!-- Status -->
    <div id="statusTab" class="tab">
      <h3>Status</h3>
      <input type="file" id="statusFile" accept="image/*,video/*" />
      <input type="text" id="statusText" placeholder="Add a text status..." />
      <button onclick="uploadStatus()">Upload Status</button>
      <div id="statusFeed"></div>
    </div>

    <!-- Groups -->
    <div id="groupsTab" class="tab">
      <h3>Groups</h3>
      <input type="text" id="groupName" placeholder="Group Name" />
      <div id="contactsList"></div>
      <button onclick="createGroup()">Create Group</button>
      <div id="groupList"></div>
    </div>

    <!-- Settings -->
    <div id="settingsTab" class="tab">
      <h3>Settings</h3>
      <form class="settingsForm" onsubmit="updateProfile(event)">
        <input type="text" id="username" placeholder="Change Username" />
        <input type="file" id="profilePic" accept="image/*" />
        <input type="password" id="password" placeholder="New Password" />
        <select id="privacy">
          <option value="everyone">Everyone</option>
          <option value="contacts">My Contacts</option>
          <option value="nobody">Nobody</option>
        </select>
        <button type="submit">Save</button>
      </form>
    </div>
  </div>

  <nav>
    <button onclick="showTab('chatsTab')" class="active">Chats</button>
    <button onclick="showTab('statusTab')">Status</button>
    <button onclick="showTab('groupsTab')">Groups</button>
    <button onclick="showTab('settingsTab')">Settings</button>
  </nav>
</div>

<footer>App by: PAUL MAKOKHA</footer>

<script>
const API = "https://campus-dating-backend-18.onrender.com";
let currentUser = null;
let contacts = [];
let currentChat = null;
let chatInterval = null;

// UI Switches
function showLogin() { document.getElementById('loginForm').classList.remove('hidden'); document.getElementById('registerForm').classList.add('hidden'); document.getElementById('forgotForm').classList.add('hidden'); }
function showRegister() { document.getElementById('loginForm').classList.add('hidden'); document.getElementById('registerForm').classList.remove('hidden'); document.getElementById('forgotForm').classList.add('hidden'); }
function showForgot() { document.getElementById('loginForm').classList.add('hidden'); document.getElementById('registerForm').classList.add('hidden'); document.getElementById('forgotForm').classList.remove('hidden'); }
function showTab(tabId) { document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); document.getElementById(tabId).classList.add('active'); document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); }

// Register
async function register() {
  const countryCode = document.getElementById('countryCode').value;
  const phone = document.getElementById('regPhone').value;
  const password = document.getElementById('regPassword').value;
  const avatar = document.getElementById('regAvatar').files[0];
  const fullPhone = countryCode + phone;

  const formData = new FormData();
  formData.append('phone', fullPhone);
  formData.append('password', password);
  if (avatar) formData.append('avatar', avatar);

  const res = await fetch(`${API}/auth/register`, { method: 'POST', body: formData });
  if (res.ok) { alert('Registered successfully'); showLogin(); }
  else alert('Registration failed');
}

// Login
async function login() {
  const phone = document.getElementById('loginPhone').value;
  const password = document.getElementById('loginPassword').value;

  const res = await fetch(`${API}/auth/login`, {
    method: 'POST',
    headers: { 'Content-Type':'application/json' },
    body: JSON.stringify({ phone, password })
  });

  if (res.ok) {
    const data = await res.json();
    currentUser = phone;
    localStorage.setItem('token', data.token);
    document.getElementById('authContainer').classList.add('hidden');
    document.getElementById('appContainer').classList.remove('hidden');
    loadContactsForGroups();
    loadGroups();
    loadStatus();
  } else alert('Login failed');
}

// Forgot Password
async function forgotPassword() {
  const phone = document.getElementById('forgotPhone').value;
  alert('Reset link/SMS to ' + phone);
}
</script>
</body>
</html>
