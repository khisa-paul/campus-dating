socket.on("update-users", (users) => {
  // users is an object: { alice: "online", bob: "last seen ..." }
  loadContacts(users);
});

function loadContacts(userStatuses = {}) {
  fetch(`${API}/api/contacts/${currentUser}`)
    .then(res => res.json())
    .then(contacts => {
      contactsDiv.innerHTML = "";
      contacts.forEach(contact => {
        const div = document.createElement("div");
        div.innerHTML = `
          <span>${contact}</span>
          <small style="color:gray; margin-left:8px;">
            ${userStatuses[contact] || "offline"}
          </small>
        `;

        if (unreadCounts[contact]) {
          const badge = document.createElement("span");
          badge.className = "badge";
          badge.textContent = unreadCounts[contact];
          div.appendChild(badge);
        }

        div.onclick = () => {
          selectContact(contact);
          unreadCounts[contact] = 0;
          loadContacts(userStatuses);
        };

        if (contact === activeContact) div.classList.add("active");
        contactsDiv.appendChild(div);
      });
    });
}

